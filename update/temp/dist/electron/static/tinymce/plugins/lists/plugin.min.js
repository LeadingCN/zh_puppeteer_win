!function(){"use strict";var e,t,n,r,o,i,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(){},s=function(e){return function(){return e}},c=function(e){return function(t){return!e(t)}},f=s(!1),d=s(!0),l=function(){return m},m=(e=function(e){return e.isNone()},{fold:function(e,t){return e()},is:f,isSome:f,isNone:d,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:s(null),getOrUndefined:s(void 0),or:n,orThunk:t,map:l,each:a,bind:l,exists:f,forall:d,filter:l,equals:e,equals_:e,toArray:function(){return[]},toString:s("none()")}),p=function(e){var t=s(e),n=function(){return o},r=function(t){return t(e)},o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:d,isNone:f,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return p(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?o:m},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(f,(function(t){return n(e,t)}))}};return o},g={some:p,none:l,from:function(e){return null==e?m:p(e)}},v=function(e){return function(t){return r=typeof(n=t),(null===n?"null":"object"==r&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":r)===e;var n,r}},h=function(e){return function(t){return typeof t===e}},y=v("string"),S=v("array"),b=h("boolean"),C=h("function"),O=h("number"),N=Array.prototype.slice,L=Array.prototype.push,T=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o)}return r},k=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},x=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r)&&n.push(i)}return n},A=function(e,t,n){return k(e,(function(e){n=t(n,e)})),n},D=function(e,t,n){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(t(i,r))return g.some(i);if(n(i,r))break}return g.none()},w=function(e,t){return D(e,t,f)},B=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!S(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);L.apply(t,e[n])}return t}(T(e,t))},E=function(e){var t=N.call(e,0);return t.reverse(),t},R=function(e,t){return 0<=t&&t<e.length?g.some(e[t]):g.none()},P=function(e){return R(e,0)},I=function(e){return R(e,e.length-1)},M=function(){return(M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},U=function(){return _(0,0)},_=function(e,t){return{major:e,minor:t}},F=function(e,t){var n=String(t).toLowerCase();return 0===e.length?U():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return _(r(1),r(2))}(e,n)},$=U,j=function(e,t){var n=String(t).toLowerCase();return w(e,(function(e){return e.search(n)}))},q=function(e,t){return-1!==e.indexOf(t)},H=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,W=function(e){return function(t){return q(t,e)}},K=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return q(e,"edge/")&&q(e,"chrome")&&q(e,"safari")&&q(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,H],search:function(e){return q(e,"chrome")&&!q(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return q(e,"msie")||q(e,"trident")}},{name:"Opera",versionRegexes:[H,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:W("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:W("firefox")},{name:"Safari",versionRegexes:[H,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(q(e,"safari")||q(e,"mobile/"))&&q(e,"applewebkit")}}],Q=[{name:"Windows",search:W("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return q(e,"iphone")||q(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:W("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:W("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:W("linux"),versionRegexes:[]},{name:"Solaris",search:W("sunos"),versionRegexes:[]},{name:"FreeBSD",search:W("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:W("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],X={browsers:s(K),oses:s(Q)},V="Edge",z="Firefox",Y=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isEdge:r(V),isChrome:r("Chrome"),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r(z),isSafari:r("Safari")}},G=function(){return Y({current:void 0,version:$()})},J=Y,Z=(s(V),s("Chrome"),s("IE"),s("Opera"),s(z),s("Safari"),"Windows"),ee="Android",te="Solaris",ne="FreeBSD",re="ChromeOS",oe=function(e){var t=e.current,n=e.version,r=function(e){return function(){return t===e}};return{current:t,version:n,isWindows:r(Z),isiOS:r("iOS"),isAndroid:r(ee),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(te),isFreeBSD:r(ne),isChromeOS:r(re)}},ie=function(){return oe({current:void 0,version:$()})},ue=oe,ae=(s(Z),s("iOS"),s(ee),s("Linux"),s("OSX"),s(te),s(ne),s(re),function(e,t){var n,r,o,i,u,a,c,f,d,l,m,p,g=X.browsers(),v=X.oses(),h=function(e,t){return j(e,t).map((function(e){var n=F(e.versionRegexes,t);return{current:e.name,version:n}}))}(g,e).fold(G,J),y=function(e,t){return j(e,t).map((function(e){var n=F(e.versionRegexes,t);return{current:e.name,version:n}}))}(v,e).fold(ie,ue);return{browser:h,os:y,deviceType:(r=h,o=e,i=t,u=(n=y).isiOS()&&!0===/ipad/i.test(o),a=n.isiOS()&&!u,c=n.isiOS()||n.isAndroid(),f=c||i("(pointer:coarse)"),d=u||!a&&c&&i("(min-device-width:768px)"),l=a||c&&!d,m=r.isSafari()&&n.isiOS()&&!1===/safari/i.test(o),p=!l&&!d&&!m,{isiPad:s(u),isiPhone:s(a),isTablet:s(d),isPhone:s(l),isTouch:s(f),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:s(m),isDesktop:s(p)})}}),se=function(e){return window.matchMedia(e).matches},ce=(i=!(r=function(){return ae(navigator.userAgent,se)}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i||(i=!0,o=r.apply(null,e)),o}),fe=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},de=function(e,t){var n=(t||document).createElement(e);return fe(n)},le=fe,me=function(e,t){return e.dom===t.dom},pe=function(e,t){return ce().browser.isIE()?function(e,t){return n=e.dom,r=t.dom,o=Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(n.compareDocumentPosition(r)&o);var n,r,o}(e,t):(n=t,(r=e.dom)!==(o=n.dom)&&r.contains(o));var n,r,o},ge=function(e,t){var n=e.dom;if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},ve=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),he=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),ye=tinymce.util.Tools.resolve("tinymce.util.VK"),Se=Object.keys,be=function(e,t){for(var n=Se(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i)}},Ce=("undefined"!=typeof window||Function("return this;")(),function(e){return e.dom.nodeName.toLowerCase()}),Oe=(1,function(e){return 1===e.dom.nodeType}),Ne=function(e,t){var n=e.dom;be(t,(function(e,t){!function(e,t,n){if(!(y(n)||b(n)||O(n)))throw new Error("Attribute value was not simple");e.setAttribute(t,n+"")}(n,t,e)}))},Le=function(e){return A(e.dom.attributes,(function(e,t){return e[t.name]=t.value,e}),{})},Te=function(e){return g.from(e.dom.parentNode).map(le)},ke=function(e){return T(e.dom.childNodes,le)},xe=function(e,t){var n=e.dom.childNodes;return g.from(n[t]).map(le)},Ae=function(e){return xe(e,0)},De=function(e){return xe(e,e.dom.childNodes.length-1)},we=function(e,t){Te(e).each((function(n){n.dom.insertBefore(t.dom,e.dom)}))},Be=function(e,t){e.dom.appendChild(t.dom)},Ee=function(e,t){k(t,(function(t){Be(e,t)}))},Re=function(e){var t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},Pe=function(e){return!0,le(e.dom.cloneNode(true))},Ie=function(e,t){var n,r,o,i=(n=e,r=de(t),o=Le(n),Ne(r,o),r);we(e,i);var u=ke(e);return Ee(i,u),Re(e),i},Me=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Ue=tinymce.util.Tools.resolve("tinymce.util.Tools"),_e=function(e){return function(t){return t&&t.nodeName.toLowerCase()===e}},Fe=function(e){return function(t){return t&&e.test(t.nodeName)}},$e=function(e){return e&&3===e.nodeType},je=Fe(/^(OL|UL|DL)$/),qe=Fe(/^(OL|UL)$/),He=_e("ol"),We=Fe(/^(LI|DT|DD)$/),Ke=Fe(/^(DT|DD)$/),Qe=Fe(/^(TH|TD)$/),Xe=_e("br"),Ve=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},ze=function(e,t){return e&&e.nodeName in t},Ye=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},Ge=function(e,t){return e.isChildOf(t,e.getRoot())},Je=function(e,t){var n,r,o,i,u=e.dom,a=e.schema.getBlockElements(),s=u.createFragment(),c=!1===(n=e.getParam("forced_root_block","p"))?"":!0===n?"p":n;if(c&&((o=u.create(c)).tagName===c.toUpperCase()&&u.setAttribs(o,e.getParam("forced_root_block_attrs",{})),ze(t.firstChild,a)||s.appendChild(o)),t)for(;r=t.firstChild;){var f=r.nodeName;i||"SPAN"===f&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),ze(r,a)?(s.appendChild(r),o=null):c?(o||(o=u.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(u.create("br",{"data-mce-bogus":"1"})):s.appendChild(u.create("br")),s},Ze=Me.DOM,et=function(e){ge(e,"dt")&&Ie(e,"dd")},tt=function(e,t){if($e(e))return{container:e,offset:t};var n=ve.getNode(e,t);return $e(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&$e(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&$e(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},nt=function(e){var t=e.cloneRange(),n=tt(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=tt(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},rt=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),ot=function(e,t){var n=t||e.selection.getStart(!0);return e.dom.getParent(n,"OL,UL,DL",ut(e,n))},it=function(e){var t,n,r,o=e.selection.getSelectedBlocks();return Ue.grep((t=e,n=o,r=Ue.map(n,(function(e){return t.dom.getParent(e,"li,dd,dt",ut(t,e))||e})),rt.unique(r)),(function(e){return We(e)}))},ut=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},at=function(e,t){var n=e.dom.getParents(t,"ol,ul",ut(e,t));return I(n)},st=function(e,t){var n=T(t,(function(t){return at(e,t).getOr(t)}));return rt.unique(n)},ct=function(e,t,n){return e.isSome()&&t.isSome()?g.some(n(e.getOrDie(),t.getOrDie())):g.none()},ft=function(e,t,n){return e.fire("ListMutation",{action:t,element:n})},dt=function(e,t,n){if(!y(n))throw new Error("CSS value must be a string: "+n);var r;void 0!==(r=e).style&&C(r.style.getPropertyValue)&&e.style.setProperty(t,n)},lt=function(e,t){Be(e.item,t.list)},mt=function(e,t,n){var r=t.slice(0,n.depth);return I(r).each((function(t){var r,o,i,u,a,s,c,f;s=(r=e,o=n.itemAttributes,i=n.content,u=de("li",r),Ne(u,o),Ee(u,i),u),Be((a=t).list,s),a.item=s,f=n,Ce((c=t).list)!==f.listType&&(c.list=Ie(c.list,f.listType)),Ne(c.list,f.listAttributes)})),r},pt=function(e,t,n){var r,o=function(e,t,n){for(var r,o,i,u=[],a=0;a<n;a++)u.push((r=e,o=t.listType,i={list:de(o,r),item:de("li",r)},Be(i.list,i.item),i));return u}(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)lt(e[t-1],e[t])}(o),function(e,t){for(var n,r=0;r<e.length-1;r++)n=e[r].item.dom,dt(n,"list-style-type","none");I(e).each((function(e){Ne(e.list,t.listAttributes),Ne(e.item,t.itemAttributes),Ee(e.item,t.content)}))}(o,n),r=o,ct(I(t),P(r),lt),t.concat(o)},gt=function(e){return ge(e,"OL,UL")},vt=function(e){return Ae(e).map(gt).getOr(!1)},ht=function(e){return 0<e.depth},yt=function(e){return e.isSelected},St=function(e){var t=ke(e),n=De(e).map(gt).getOr(!1)?t.slice(0,-1):t;return T(n,Pe)},bt=function(e){return k(e,(function(t,n){var r,o,i,u,s;i=(r=e)[o=n].depth,u=function(e){return e.depth===i&&!e.dirty},s=function(e){return e.depth<i},D(E(r.slice(0,o)),u,s).orThunk((function(){return D(r.slice(o+1),u,s)})).fold((function(){var e;t.dirty&&((e=t).listAttributes=function(e,t){var n,r,o,i,u={};return n=t,i=u,r=function(e,t){i[t]=e},o=a,be(e,(function(e,t){(n(e,t)?r:o)(e,t)})),u}(e.listAttributes,(function(e,t){return"start"!==t})))}),(function(e){return r=e,(n=t).listType=r.listType,void(n.listAttributes=M({},r.listAttributes));var n,r}))})),e},Ct=function(e,t,n,r){return Ae(r).filter(gt).fold((function(){t.each((function(e){me(e.start,r)&&n.set(!0)}));var o,i,u,a=(o=r,i=e,u=n.get(),Te(o).filter(Oe).map((function(e){return{depth:i,dirty:!1,isSelected:u,content:St(o),itemAttributes:Le(o),listAttributes:Le(e),listType:Ce(e)}})));t.each((function(e){me(e.end,r)&&n.set(!1)}));var s=De(r).filter(gt).map((function(r){return Ot(e,t,n,r)})).getOr([]);return a.toArray().concat(s)}),(function(r){return Ot(e,t,n,r)}))},Ot=function(e,t,n,r){return B(ke(r),(function(r){return(gt(r)?Ot:Ct)(e+1,t,n,r)}))},Nt=function(e,t){var n=bt(t);return T(n,(function(t){var n,r,o=(n=t.content,r=document.createDocumentFragment(),k(n,(function(e){r.appendChild(e.dom)})),le(r));return le(Je(e,o.dom))}))},Lt=function(e,t){var n,r,o=bt(t);return n=e.contentDocument,r=A(o,(function(e,t){return(t.depth>e.length?pt:mt)(n,e,t)}),[]),P(r).map((function(e){return e.list})).toArray()},Tt=function(e,t,n){var r,o=function(e,t){var n,r=(n=!1,{get:function(){return n},set:function(e){n=e}});return T(e,(function(e){return{sourceList:e,entries:Ot(0,t,r,e)}}))}(t,(r=T(it(e),le),ct(w(r,c(vt)),w(E(r),c(vt)),(function(e,t){return{start:e,end:t}}))));k(o,(function(t){var r,o;r=t.entries,o=n,k(x(r,yt),(function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0}(o,e),0}));var i,u,a,s=(i=e,u=t.entries,B(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=t(a);s!==n&&(r.push(o),o=[]),n=s,o.push(a)}return 0!==o.length&&r.push(o),r}(u,ht),(function(e){return(P(e).map(ht).getOr(!1)?Lt:Nt)(i,e)})));k(s,(function(t){ft(e,"Indent"===n?"IndentList":"OutdentList",t.dom)})),a=t.sourceList,k(s,(function(e){we(a,e)})),Re(t.sourceList)}))},kt=function(e,t){var n,r,o=T(function(e){var t,n,r,o=(n=at(t=e,t.selection.getStart()),r=x(t.selection.getSelectedBlocks(),qe),n.toArray().concat(r));return st(e,o)}(e),le),i=T(x(it(e),Ke),le),u=!1;return(o.length||i.length)&&(n=e.selection.getBookmark(),Tt(e,o,t),r=e,k(i,"Indent"===t?et:function(e){return function(e,t){ge(t,"dd")?Ie(t,"dt"):ge(t,"dt")&&Te(t).each((function(n){return function(e,t,n){var r=Ze.select('span[data-mce-type="bookmark"]',t),o=Je(e,n),i=Ze.createRng();i.setStartAfter(n),i.setEndAfter(t);for(var u,a=i.extractContents(),s=a.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){Ze.remove(s);break}e.dom.isEmpty(a)||Ze.insertAfter(a,t),Ze.insertAfter(o,t),Ye(e.dom,n.parentNode)&&(u=n.parentNode,Ue.each(r,(function(e){u.parentNode.insertBefore(e,n.parentNode)})),Ze.remove(u)),Ze.remove(n),Ye(e.dom,t)&&Ze.remove(t)}(e,n.dom,t.dom)}))}(r,e),0}),e.selection.moveToBookmark(n),e.selection.setRng(nt(e.selection.getRng())),e.nodeChanged(),u=!0),u},xt=function(e){return kt(e,"Indent")},At=function(e){return kt(e,"Outdent")},Dt=function(e){return kt(e,"Flatten")},wt=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),Bt=Me.DOM,Et=function(e){var t={},n=function(n){var r,o=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"];1===o.nodeType&&(r=Bt.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),n?o.insertBefore(r,o.childNodes[i]):Bt.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),t[n?"startContainer":"endContainer"]=o,t[n?"startOffset":"endOffset"]=i};return n(!0),e.collapsed||n(),t},Rt=function(e){function t(t){var n,r=n=e[t?"startContainer":"endContainer"],o=e[t?"startOffset":"endOffset"];r&&(1===r.nodeType&&(o=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(r),r=r.parentNode,Bt.remove(n),!r.hasChildNodes()&&Bt.isBlock(r)&&r.appendChild(Bt.create("br"))),e[t?"startContainer":"endContainer"]=r,e[t?"startOffset":"endOffset"]=o)}t(!0),t();var n=Bt.createRng();return n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),nt(n)},Pt=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},It=function(e){return/\btox\-/.test(e.className)},Mt=function(e,t,n){var r=function(e){var r=D(e.parents,je,Qe).filter((function(e){return e.nodeName===t&&!It(e)})).isSome();n(r)},o=e.dom.getParents(e.selection.getNode());return r({parents:o}),e.on("NodeChange",r),function(){return e.off("NodeChange",r)}},Ut=function(e,t){Ue.each(t,(function(t,n){e.setAttribute(n,t)}))},_t=function(e,t,n){var r,o,i,u,a,s,c;r=e,o=t,u=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",u),a=e,Ut(s=t,(c=n)["list-attributes"]),Ue.each(a.select("li",s),(function(e){Ut(e,c["list-item-attributes"])}))},Ft=function(e,t,n,r){var o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&Xe(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Ve(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},$t=function(e,t,n){return s=n,(a=t)&&s&&je(a)&&a.nodeName===s.nodeName&&(i=t,u=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(u,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,u,a,s},jt=function(e,t){var n,r=t.nextSibling;if($t(e,t,r)){for(;n=r.firstChild;)t.appendChild(n);e.remove(r)}if(r=t.previousSibling,$t(e,t,r)){for(;n=r.lastChild;)t.insertBefore(n,t.firstChild);e.remove(r)}},qt=function(e){return"list-style-type"in e},Ht=function(e,t,n){var r,o,i,u,a,s,c=ot(e),f=function(e){var t,n,r,o=ot(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,Ue.grep(t.querySelectorAll("ol,ul,dl"),(function(e){return je(e)}))):Ue.grep(i,(function(e){return je(e)&&o!==e}))}(e);n=n||{},c&&0<f.length?function(e,t,n,r,o){var i;t.nodeName!==r||qt(o)?(i=Et(e.selection.getRng(!0)),Ue.each([t].concat(n),(function(t){var n,i,u,a,s;n=e,u=r,a=o,(i=t).nodeName!==u?(s=n.dom.rename(i,u),_t(n.dom,s,a),ft(n,Pt(u),s)):(_t(n.dom,i,a),ft(n,Pt(u),i))})),e.selection.setRng(Rt(i))):Dt(e)}(e,c,f,t,n):(i=t,u=n,(o=c)!==(r=e).getBody()&&(o?o.nodeName!==i||qt(u)||It(o)?(a=Et(r.selection.getRng(!0)),_t(r.dom,o,u),s=r.dom.rename(o,i),jt(r.dom,s),r.selection.setRng(Rt(a)),ft(r,Pt(i),s)):Dt(r):(function(e,t,n){void 0===n&&(n={});var r,o=e.selection.getRng(),i="LI",u=ut(e,e.selection.getStart(!0)),a=e.dom;"false"!==a.getContentEditable(e.selection.getNode())&&("DL"===(t=t.toUpperCase())&&(i="DT"),r=Et(o),Ue.each(function(e,t,n){for(var r,o=[],i=e.dom,u=Ft(e,t,!0,n),a=Ft(e,t,!1,n),s=[],c=u;c&&(s.push(c),c!==a);c=c.nextSibling);return Ue.each(s,(function(t){if(Ve(e,t))return o.push(t),void(r=null);if(i.isBlock(t)||Xe(t))return Xe(t)&&i.remove(t),void(r=null);var u=t.nextSibling;wt.isBookmarkNode(t)&&(Ve(e,u)||!u&&t.parentNode===n)?r=null:(r||(r=i.create("p"),t.parentNode.insertBefore(r,t),o.push(r)),r.appendChild(t))})),o}(e,o,u),(function(r){var o,u,s,c,f,d,l,m=r.previousSibling;m&&je(m)&&m.nodeName===t&&(u=m,s=n,a.getStyle(u,"list-style-type")===(c=null===(c=s?s["list-style-type"]:"")?"":c))?(o=m,r=a.rename(r,i),m.appendChild(r)):(o=a.create(t),r.parentNode.insertBefore(o,r),o.appendChild(r),r=a.rename(r,i)),f=a,d=r,l=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],Ue.each(l,(function(e){var t;return f.setStyle(d,((t={})[e]="",t))})),_t(a,o,n),jt(e.dom,o)})),e.selection.setRng(Rt(r)))}(r,i,u),ft(r,Pt(i),o))))},Wt=Me.DOM,Kt=function(e,t,n,r){var o=t.startContainer,i=t.startOffset;if($e(o)&&(n?i<o.data.length:0<i))return o;var u=e.schema.getNonEmptyElements();1===o.nodeType&&(o=ve.getNode(o,i));var a,s,c=new he(o,r);for(n&&(a=e.dom,Xe(s=o)&&a.isBlock(s.nextSibling)&&!Xe(s.previousSibling)&&c.next());o=c[n?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if($e(o)&&0<o.data.length)return o}},Qt=function(e,t){var n=t.childNodes;return 1===n.length&&!je(n[0])&&e.isBlock(n[0])},Xt=function(e,t,n){var r,o,i,u=t.parentNode;Ge(e,t)&&Ge(e,n)&&(je(n.lastChild)&&(r=n.lastChild),u===n.lastChild&&Xe(u.previousSibling)&&e.remove(u.previousSibling),(o=n.lastChild)&&Xe(o)&&t.hasChildNodes()&&e.remove(o),Ye(e,n,!0)&&e.$(n).empty(),function(e,t,n){var r,o,i,u=Qt(e,n)?n.firstChild:n;if(Qt(o=e,i=t)&&o.remove(i.firstChild,!0),!Ye(e,t,!0))for(;r=t.firstChild;)u.appendChild(r)}(e,t,n),r&&n.appendChild(r),i=pe(le(n),le(t))?e.getParents(t,je,n):[],e.remove(t),k(i,(function(t){Ye(e,t)&&t!==e.getRoot()&&e.remove(t)})))},Vt=function(e,t){var n=e.dom,r=e.selection,o=r.getStart(),i=ut(e,o),u=n.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===e.getBody()&&Ye(n,a))return!0;var s=nt(r.getRng()),c=n.getParent(Kt(e,s,t,i),"LI",i);if(c&&c!==u)return e.undoManager.transact((function(){var n;t?function(e,t,n,r){var o,i,u,a,s=e.dom;s.isEmpty(r)?(u=n,a=r,(i=e).dom.$(a).empty(),Xt(i.dom,u,a),i.selection.setCursorLocation(a)):(o=Et(t),Xt(s,n,r),e.selection.setRng(Rt(o)))}(e,s,c,u):(n=u).parentNode.firstChild===n?At(e):function(e,t,n,r){var o=Et(t);Xt(e.dom,n,r);var i=Rt(o);e.selection.setRng(i)}(e,s,u,c)})),!0;if(!c&&!t&&0===s.startOffset&&0===s.endOffset)return e.undoManager.transact((function(){Dt(e)})),!0}return!1},zt=function(e,t){return e.selection.isCollapsed()?Vt(i=e,u=t)||function(e,t){var n=e.dom,r=e.selection.getStart(),o=ut(e,r),i=n.getParent(r,n.isBlock,o);if(i&&n.isEmpty(i)){var u=nt(e.selection.getRng()),a=n.getParent(Kt(e,u,t,o),"LI",o);if(a)return e.undoManager.transact((function(){var r,u,s,c;u=i,s=o,c=(r=n).getParent(u.parentNode,r.isBlock,s),r.remove(u),c&&r.isEmpty(c)&&r.remove(c),jt(n,a.parentNode),e.selection.select(a,!0),e.selection.collapse(t)})),!0}return!1}(i,u):(r=(n=e).selection.getStart(),o=ut(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<it(n).length)&&(n.undoManager.transact((function(){n.execCommand("Delete"),function(e,t){Ue.each(Ue.grep(e.select("ol,ul",t)),(function(t){var n,r,o,i;n=e,"LI"===(i=(r=t).parentNode).nodeName&&i.firstChild===r&&((o=i.previousSibling)&&"LI"===o.nodeName?(o.appendChild(r),Ye(n,i)&&Wt.remove(i)):Wt.setStyle(i,"listStyleType","none")),je(i)&&(o=i.previousSibling)&&"LI"===o.nodeName&&o.appendChild(r)}))}(n.dom,n.getBody())})),!0));var n,r,o,i,u},Yt=function(e){var t=e.dom,n=ot(e);He(n)&&e.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:t.getAttrib(n,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(n){var r=n.getData();e.undoManager.transact((function(){t.setAttrib(ot(e),"start","1"===r.start?"":r.start)})),n.close()}})},Gt=function(e,t){return function(){var n=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName===t}};u.add("lists",(function(e){var t,n,r,o,i,u;return!1===e.hasPlugin("rtc",!0)&&(function(e){var t,n;e.getParam("lists_indent_on_tab",!0)&&(t=e).on("keydown",(function(e){e.keyCode!==ye.TAB||ye.metaKeyPressed(e)||t.undoManager.transact((function(){(e.shiftKey?At:xt)(t)&&e.preventDefault()}))})),(n=e).on("keydown",(function(e){e.keyCode===ye.BACKSPACE?zt(n,!1)&&e.preventDefault():e.keyCode===ye.DELETE&&zt(n,!0)&&e.preventDefault()}))}(e),(t=e).on("BeforeExecCommand",(function(e){var n=e.command.toLowerCase();"indent"===n?xt(t):"outdent"===n&&At(t)})),t.addCommand("InsertUnorderedList",(function(e,n){Ht(t,"UL",n)})),t.addCommand("InsertOrderedList",(function(e,n){Ht(t,"OL",n)})),t.addCommand("InsertDefinitionList",(function(e,n){Ht(t,"DL",n)})),t.addCommand("RemoveList",(function(){Dt(t)})),t.addCommand("mceListProps",(function(){Yt(t)})),t.addQueryStateHandler("InsertUnorderedList",Gt(t,"UL")),t.addQueryStateHandler("InsertOrderedList",Gt(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",Gt(t,"DL"))),r=function(e){return function(){return n.execCommand(e)}},(n=e).hasPlugin("advlist")||(n.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:r("InsertOrderedList"),onSetup:function(e){return Mt(n,"OL",e.setActive)}}),n.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:r("InsertUnorderedList"),onSetup:function(e){return Mt(n,"UL",e.setActive)}})),i={text:"List properties...",icon:"ordered-list",onAction:function(){return Yt(o)},onSetup:function(e){return Mt(o,"OL",(function(t){return e.setDisabled(!t)}))}},(o=e).ui.registry.addMenuItem("listprops",i),o.ui.registry.addContextMenu("lists",{update:function(e){var t=ot(o,e);return He(t)?["listprops"]:[]}}),u=e,{backspaceDelete:function(e){zt(u,e)}}}))}();